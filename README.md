

# 【Unity C#開発向け詳細要件定義書】  
**プロジェクト名：仮称「VNエロゲプロジェクト」**  
**対象：Unity C#プログラマー**  
**目的：ビジュアルノベルゲームのC#部分の機能開発全般**



## ✅ 使用技術
- Unity 2022以降（URP非必須、Canvas UI前提）
- C#
- Ink Unity Integration（v1.2以降）
- シリアライズ形式：JSON or BinaryFormatter
- Save/Load用：`Application.persistentDataPath`
- 入力制御：`InputSystem`もしくは`Input.GetKey`（旧）

---

## 🔧 開発対象機能一覧（C#実装範囲）

---

### 📖 1. シナリオ制御（Ink連携）
**目的**：Inkファイルからストーリー制御、テキスト表示、選択肢分岐

#### 実装内容
- Inkストーリー読み込み（`.ink.json`）
- 次のセリフ行を取得してUIに渡す
- 選択肢が存在する場合はUIに反映（複数可）
- セリフにタグが含まれる場合の処理分岐（例：キャラ名、表情、イベントトリガーなど）
- ユーザー入力（Enter / Space / DownArrow）でメッセージ進行
- InkStateの保存・復元（セーブ対応のため）

---

### 💾 2. セーブ / ロード機能（90スロット対応）
**目的**：ユーザーが進行状況を保存・読込できる機能

#### 仕様
- セーブスロット：9スロット × 10ページ（計90）
- セーブ内容：
  - InkStory状態（JSON化）
  - 表示中テキスト
  - タグ/ラベル
  - システム設定（音量等）
  - スクリーンショット（シーンのプレビュー画像）
- UI：
  - セーブ/ロード画面のページ切替
  - サムネイル表示（`ReadPixels`利用）
- 保存形式：`.json` + `.png`
- データ保存場所：`Application.persistentDataPath`

---

### ⚙️ 3. 設定（Config）機能
**目的**：ゲーム全体の環境設定をユーザーが調整できる

#### 設定項目
- オートモードの待機時間（float秒）
- ウィンドウ／フルスクリーン切り替え（bool）
- BGM音量（0.0～1.0）
- SE音量（0.0～1.0）
- テキストウィンドウ透明度（0.0～1.0）

#### データ保存
- 起動時に読み込み／終了時に保存
- 保存形式：`PlayerPrefs` または `JSON`

---

### 📝 4. バックログ（履歴ログ）
**目的**：過去に表示されたメッセージ履歴を閲覧できる機能

#### 機能内容
- 最大50件まで記録（古い順から消えるリングバッファ形式）
- 情報内容：
  - セリフ本文
  - キャラクター名
  - 表示時間 or 行番号
- ジャンプ機能付き（選択時に該当Inkのラベルへジャンプ）
- 履歴UIにジャンプボタンを付与

---

### ⏩ 5. スキップ系機能
**目的**：プレイヤーの任意操作でメッセージの高速進行を可能にする

#### スキップ種別
- **スキップボタン**：
  - ボタン押下で0.3秒間隔で自動進行
  - ボタン再度押すまで続行（`InvokeRepeating` or Coroutine）
- **Ctrlキー**：
  - Ctrlキーを押している間だけスキップ動作
- **選択肢までスキップ**：
  - 自動で次の選択肢が出るまで進行し、選択肢出現時に停止

---

### 🤖 6. オートモード
**目的**：一定間隔で自動進行するプレイモード

#### 仕様
- オートボタン押下で有効化、再度押すと無効化
- 待機時間はConfigで設定（例：1.5秒）
- セリフ毎に待機→次の行へ進行

---

### 🧭 7. UI操作・シーン制御
**目的**：ゲームプレイ中の操作と状態制御を担う

#### 実装内容
- UI常駐メニュー制御：
  - Config
  - セーブ
  - ロード
  - バックログ
  - タイトルに戻る
  - スキップ
  - 次の選択肢までスキップ
  - オートモード
- シーン遷移：
  - タイトル → ゲーム
  - タイトル → ロード
  - ゲーム → タイトル など

---

## 📁 推奨フォルダ構成（C#）

```
/Scripts
  /Ink
    - InkManager.cs
    - DialogueLine.cs
  /Save
    - SaveLoadManager.cs
    - SaveData.cs
    - ConfigManager.cs
  /System
    - GameStateManager.cs
    - InputManager.cs
  /UI
    - UIManager.cs
    - BacklogUI.cs
    - ConfigUI.cs
    - SaveSlotUI.cs
```

---

## 🧱 推奨クラス構成と責任範囲（概要）

| クラス名            | 機能概要                                       |
|---------------------|------------------------------------------------|
| `InkManager`        | InkStory制御、テキスト/選択肢取得、ジャンプ     |
| `SaveLoadManager`   | セーブ・ロード処理、スクリーンショット取得     |
| `ConfigManager`     | 設定データ管理、読み書き、反映                  |
| `GameStateManager`  | ゲーム状態保持（シーン間共通）                 |
| `InputManager`      | キー入力とスキップ・オート制御                  |
| `BacklogManager`    | 会話履歴管理、ジャンプ処理                      |
| `UIManager`         | UI更新、ボタン制御、UI表示・非表示             |

---

## ✅ 実装順（おすすめ）

1. Ink連携 → `InkManager`
2. セリフ進行 → 入力制御 + UI表示
3. セーブ/ロードのシステム実装
4. バックログログとジャンプ機能
5. Configの保存・反映
6. スキップ / オートモードの制御
7. UI設計と常駐ボタン対応
8. シーン遷移とエラーハンドリング

---

## 🔒 備考・注意点
- セーブの際はInkStateのJSONシリアライズが必須
- セーブのサムネイル画像は低解像度にすること（サイズ最適化）
- エラー処理、入力受付ロック等も考慮（二重入力や暴発防止）
- コードは分離して再利用性を高く保つ（MVC的思想歓迎）

---

